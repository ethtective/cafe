{"version":3,"file":"4.a672034b8552dfe64d6a.hot-update.js","sources":["webpack:///js/metadata.js"],"sourcesContent":["import Eth from \"ethjs\";\nimport eip55 from \"eip55\";\nimport abi from \"../abi/metadata.json\";\nimport IPFS from \"ipfs-mini\";\nlet reader = {};\nconst eth = new Eth(new Eth.HttpProvider(\"https://ropsten.infura.io\"));\n\nconst ipfs = new IPFS({\n    host: \"ipfs.infura.io\",\n    port: 5001,\n    protocol: \"https\",\n});\n\nexport default class MetaDataContract {\n    constructor() {\n        this.contract_address = \"0x7f0b2a8c93db220637f835ef075e3dbc17beff7d\";\n        this.contract = eth.contract(abi).at(this.contract_address);\n        this.price = 0;\n        // console.log(\"constructed\");\n        reader = new FileReader();\n        // uncomment to enable MetaMask support:\n        if (\n            typeof window.web3 !== \"undefined\" &&\n            typeof window.web3.currentProvider !== \"undefined\"\n        ) {\n            eth.setProvider(window.web3.currentProvider);\n            console.log(\"metamask!\", eth);\n        } else {\n            // keep current infura provider\n            // console.log(\"yay\");\n        }\n    }\n\n    async getPrice() {\n        return this.contract.getPrice().then(result => {\n            // console.log(result[0]);\n            this.price = result[0];\n\n            return Eth.fromWei(result[0], \"ether\");\n        });\n    }\n\n    async getAddress(address) {\n        return this.contract\n            .getByAddress(eip55.encode(address))\n            .then(result => {\n                // console.log(result);\n                result[0] = eip55.encode(result[0]);\n                return {\n                    address: result[0],\n                    name: result[1],\n                    image: result[2],\n                };\n            })\n            .catch(err => {\n                console.error(err);\n            });\n    }\n\n    async lookUp(address, callback) {\n        ipfs.cat(address, (err, result) => {\n            // console.log(result);\n            callback(result);\n        });\n    }\n\n    async convertBlobToBase64(blob) {\n        console.log(blob);\n        return new Promise((resolve, reject) => {\n            reader.onerror = () => {\n                reader.abort();\n                reject(new DOMException(\"Problem parsing input file.\"));\n            };\n            reader.onload = () => {\n                resolve(reader.result);\n            };\n            console.log(blob);\n            reader.readAsDataURL(blob[0]);\n        });\n    }\n\n    async addMetaData(address, name, image) {\n        let base64 = await this.convertBlobToBase64(image);\n        return new Promise((resolve, reject) => {\n            ipfs.add(base64, (err, result) => {\n                console.log(result);\n                if (err)\n                    reject(new DOMException(\"Couldn't add metadata to IPFS\"));\n\n                return this.contract\n                    .addAddress(address, name, result, {\n                        from: web3.eth.accounts[0],\n                        value: this.price,\n                    })\n                    .then(result => {\n                        resolve(result);\n                    })\n                    .catch(err => {\n                        reject(err);\n                    });\n            });\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// js/metadata.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AACA;AAKA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;AAEA;;;;;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;AAEA;;;;;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AAEA;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;AACA;AACA;;AADA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AAFA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}